/*! dustjs-helpers-fixed - v1.8.1
* http://dustjs.com/
* Copyright (c) 2021 Aleksander Williams; Released under the MIT License */

!function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define(["dust.core"],t):"object"==typeof exports?(module.exports=t(require("dustjs-linkedin-fixed-with-source")),module.exports.registerWith=t):t(e.dust)}(this,function(dust){function d(e,t,n){n=n||"INFO",e=e?"{@"+e+"}: ":"",dust.log(e+t,n)}var s={};function l(e){return(t=e).stack.tail&&t.stack.tail.head&&void 0!==t.stack.tail.head.__select__&&e.get("__select__");var t}function u(e,t){var n,r=e.stack.head,s=e.rebase();e.stack&&e.stack.tail&&(s.stack=e.stack.tail);var o={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(n in t)o[n]=t[n];return s.push({__select__:o}).push(r,e.stack.index,e.stack.of)}function f(e){var t,n;if(e.isDeferredPending=!0,e.deferreds.length)for(e.isDeferredComplete=!0,t=0,n=e.deferreds.length;t<n;t++)e.deferreds[t]();e.isDeferredPending=!1}function o(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function e(s,o){return function(e,t,n,r){return function(e,t,n,r,s,o){var i,a,c=n.block,u=n.else,n=l(t)||{};if(n.isResolved&&!n.isDeferredPending)return e;if(r.hasOwnProperty("key"))a=r.key;else{if(!n.hasOwnProperty("key"))return d(s,"No key specified","WARN"),e;a=n.key}s=r.type||n.type,a=p(t.resolve(a),s),s=p(t.resolve(r.value),s),o(a,s)?(n.isPending||(i=!0,n.isPending=!0),c&&(e=e.render(c,t)),i&&(n.isResolved=!0)):u&&(e=e.render(u,t));return e}(e,t,n,r,s,o)}}function p(e,t){switch(t=t&&t.toLowerCase()){case"number":return+e;case"string":return String(e);case"boolean":return e="false"!==e&&e,Boolean(e);case"date":return new Date(e)}return e}var t,n={tap:function(e,t,n){var r;return s[r="tap"]||(d(r,"Deprecation warning: "+r+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),d(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+r.replace(/\W+/g,""),"WARN"),s[r]=!0),n.resolve(e)},sep:function(e,t,n){n=n.block;return t.stack.index!==t.stack.of-1&&n?n(e,t):e},first:function(e,t,n){return 0===t.stack.index?n.block(e,t):e},last:function(e,t,n){return t.stack.index===t.stack.of-1?n.block(e,t):e},contextDump:function(e,t,n,r){var s=t.resolve(r.to),t="full"===t.resolve(r.key)?t.stack:t.stack.head,t=JSON.stringify(t,o,2);return"console"===s?d("contextDump",t):(t=t.replace(/</g,"\\u003c"),e=e.write(t)),e},math:function(e,t,n,r){var s,o=r.key,i=r.method,a=r.operand,c=r.round;if(!r.hasOwnProperty("key")||!r.method)return d("math","`key` or `method` was not provided","ERROR"),e;switch(o=parseFloat(t.resolve(o)),a=parseFloat(t.resolve(a)),i){case"mod":0===a&&d("math","Division by 0","ERROR"),s=o%a;break;case"add":s=o+a;break;case"subtract":s=o-a;break;case"multiply":s=o*a;break;case"divide":0===a&&d("math","Division by 0","ERROR"),s=o/a;break;case"ceil":case"floor":case"round":case"abs":s=Math[i](o);break;case"toint":s=parseInt(o,10);break;default:d("math","Method `"+i+"` is not supported","ERROR")}return void 0!==s&&(c&&(s=Math.round(s)),n&&n.block?(t=u(t,{key:s}),e=e.render(n.block,t),f(l(t))):e=e.write(s)),e},select:function(e,t,n,r){var s=n.block,n={};return r.hasOwnProperty("key")&&(n.key=t.resolve(r.key)),r.hasOwnProperty("type")&&(n.type=r.type),s?(t=u(t,n),e=e.render(s,t),f(l(t))):d("select","Missing body block","WARN"),e},eq:e("eq",function(e,t){return e===t}),ne:e("ne",function(e,t){return e!==t}),lt:e("lt",function(e,t){return e<t}),lte:e("lte",function(e,t){return e<=t}),gt:e("gt",function(e,t){return t<e}),gte:e("gte",function(e,t){return t<=e}),any:function(e,t,n,r){var s=l(t);return s?s.isDeferredComplete?d("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){s.deferreds.push(function(){(e=s.isResolved?e.render(n.block,t):e).end()})}):d("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,t,n,r){var s=l(t);return s?s.isDeferredComplete?d("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){s.deferreds.push(function(){(e=!s.isResolved?e.render(n.block,t):e).end()})}):d("none","Must be used inside a {@select} block","ERROR"),e},size:function(e,t,n,r){var s,o,i=r.key;if((i=t.resolve(r.key))&&!0!==i)if(dust.isArray(i))s=i.length;else if(!isNaN(parseFloat(i))&&isFinite(i))s=i;else if("object"==typeof i)for(o in s=0,i)i.hasOwnProperty(o)&&s++;else s=(i+"").length;else s=0;return e.write(s)}};for(t in n)dust.helpers[t]=n[t];return dust});